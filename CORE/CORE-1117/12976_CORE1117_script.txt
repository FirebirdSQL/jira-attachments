CREATE TABLE RODZAJ_DZIAL
(
  RODZ_UMOWY_ID char(2) NOT NULL,
  TYP_UMOWY_ID char(1) NOT NULL,
  RODZ_DZIAL_ID char(3) NOT NULL,
  RODZ_DZIAL_NAZWA varchar(60),
  RODZ_DZIAL_PROGRAM char(1),
  RODZ_DZIAL_TANTIEMA varchar(6),
  RODZ_DZIAL_UMOWA char(1),
  RODZ_DZIAL_ANAL_KOD varchar(12),
  KONTO_INK_PART1 char(3),
  KONTO_INK_PART4 char(3),
  KONTO_PODZ_PART1 char(3),
  KONTO_PODZ_PART2 char(3),
  KONTO_PODZ_PART3 char(2),
  RODZ_REP_ID varchar(2),
  RODZ_POCHODZENIE char(1),
  RODZ_OZNACZENIE_ZLECEN varchar(2),
  RODZ_DZIAL_DATA_KRANCOWA date,
  CONSTRAINT RODZAJ_DZIAL_PK PRIMARY KEY (RODZ_UMOWY_ID,TYP_UMOWY_ID,RODZ_DZIAL_ID)
);

CREATE TABLE TYP_UMOWY
(
  TYP_UMOWY_ID char(1) NOT NULL,
  TYP_UMOWY_NAZWA varchar(14),
  CONSTRAINT TYP_UMOWY_PK PRIMARY KEY (TYP_UMOWY_ID)
);
CREATE INDEX IDX_TYP_UMOWY_NAZWA ON TYP_UMOWY (TYP_UMOWY_NAZWA);

CREATE TABLE RODZAJ_UMOWY
(
  RODZ_UMOWY_ID char(2) NOT NULL,
  TYP_UMOWY_ID char(1) NOT NULL,
  RODZ_UMOWY_NAZWA varchar(60),
  RODZ_UMOWY_SEKCJA char(2),
  RODZ_UMOWY_PROWIZJE varchar(20),
  RODZ_UMOWY_PROWIZJE_LICZBA decimal(10,2),
  MASKA_OBSZAR_ID integer NOT NULL,
  LICZ_AKTYWNE_RODZ_DZIAL integer,
  KATEGORIA_UMOWY_ID char(1),
  CONSTRAINT RODZAJ_UMOWY_PK PRIMARY KEY (RODZ_UMOWY_ID,TYP_UMOWY_ID)
);

ALTER TABLE RODZAJ_UMOWY ADD CONSTRAINT RODZAJ_UMOWY_FK
  FOREIGN KEY (TYP_UMOWY_ID) REFERENCES TYP_UMOWY (TYP_UMOWY_ID) ON UPDATE CASCADE;
CREATE INDEX IDX_RODZ_UMOWY_NAZWA ON RODZAJ_UMOWY (RODZ_UMOWY_NAZWA);
CREATE INDEX IDX_TYP_RODZ_UMOWY ON RODZAJ_UMOWY (TYP_UMOWY_ID,RODZ_UMOWY_ID);

ALTER TABLE RODZAJ_DZIAL ADD CONSTRAINT RODZAJ_DZIAL_FK
  FOREIGN KEY (RODZ_UMOWY_ID,TYP_UMOWY_ID) REFERENCES RODZAJ_UMOWY (RODZ_UMOWY_ID,TYP_UMOWY_ID) ON UPDATE CASCADE;
CREATE INDEX IDX_RODZ_DZIAL_ID ON RODZAJ_DZIAL (RODZ_DZIAL_ID);
CREATE INDEX IXA_RODZAJ_DZIAL__RODZ_REP_ID ON RODZAJ_DZIAL (RODZ_REP_ID);

CREATE TABLE WARUNKI
(
  UMOWA_ID char(8) NOT NULL,
  DYR_ID smallint NOT NULL,
  UMOWA_ID_SEQ smallint NOT NULL,
  UMOWA_ID_POZ smallint NOT NULL,
  RODZ_DZIAL_ID char(3), 
  WAR_DATA_OD date,
  WAR_DATA_DO date,
  WAR_STAWKA varchar(5),
  WAR_RYCZALT decimal(10,2),
  WAR_OKRES smallint,
  WAR_PROCENT decimal(10,2),
  WAR_PROCENT2 decimal(10,2),
 
  WAR_STAWKA_ZA numeric(16,4),
  WAR_STAWKA_ZA_TYP_ID smallint,
  WAR_GNIAZDA integer,
  CONSTRAINT WARUNKI_PK PRIMARY KEY (UMOWA_ID,DYR_ID,UMOWA_ID_SEQ,UMOWA_ID_POZ)
);

CREATE TABLE UMOWA
(
  UMOWA_ID char(8) NOT NULL,
  DYR_ID smallint NOT NULL,
  UMOWA_ID_SEQ smallint NOT NULL,  
  TYP_UMOWY_ID char(1) NOT NULL,
  RODZ_UMOWY_ID char(2) NOT NULL,  
  UMOWA_DATA_ZAWARCIA date NOT NULL,
  UMOWA_DATA_WYPOWIEDZENIA date,
  UMOWA_DATA_OD date NOT NULL,
  UMOWA_DATA_DO date,
  UMOWA_ZRODLO char(1),
  CONSTRAINT UMOWA_PK PRIMARY KEY (UMOWA_ID,DYR_ID,UMOWA_ID_SEQ)
);


ALTER TABLE UMOWA ADD CONSTRAINT UMOWA_FK2
  FOREIGN KEY (RODZ_UMOWY_ID,TYP_UMOWY_ID) REFERENCES RODZAJ_UMOWY (RODZ_UMOWY_ID,TYP_UMOWY_ID) ON UPDATE CASCADE;

ALTER TABLE WARUNKI ADD CONSTRAINT WARUNKI_FK1
  FOREIGN KEY (UMOWA_ID,DYR_ID,UMOWA_ID_SEQ) REFERENCES UMOWA (UMOWA_ID,DYR_ID,UMOWA_ID_SEQ) ON UPDATE CASCADE ON DELETE CASCADE;




SELECT
	CAST(1 AS INTEGER) AS TYP
	, U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, CAST(NULL AS CHAR(3)) AS RODZ_DZIAL_ID
	, CAST(NULL AS VARCHAR(60)) AS RODZ_DZIAL_NAZWA
	, CAST(NULL AS DECIMAL(10, 2)) AS WAR_PROCENT
	, COUNT(DISTINCT U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ) AS ILE_UMOW
	, COUNT(*) AS ILE_WARUNKOW
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_OBOWIAZUJE
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_ZAWARTYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_ZAKONCZONYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_E
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'E' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_I
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'I' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_K
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'K' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_K
FROM
	UMOWA U
	INNER JOIN WARUNKI W ON W.UMOWA_ID = U.UMOWA_ID AND W.DYR_ID = U.DYR_ID AND W.UMOWA_ID_SEQ = U.UMOWA_ID_SEQ
	LEFT JOIN RODZAJ_UMOWY RU ON RU.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RU.TYP_UMOWY_ID = U.TYP_UMOWY_ID
	LEFT JOIN RODZAJ_DZIAL RD ON RD.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RD.TYP_UMOWY_ID = U.TYP_UMOWY_ID AND RD.RODZ_DZIAL_ID = W.RODZ_DZIAL_ID
WHERE
	U.DYR_ID = 14
	AND RD.RODZ_DZIAL_ID IS NOT NULL
	AND ((W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WC2') OR (W.RODZ_DZIAL_ID = 'WC1') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE7') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WE*') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'WM*') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'UF1') OR (W.RODZ_DZIAL_ID = 'UF2') OR (W.RODZ_DZIAL_ID = 'UFV') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W32') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'RK1') OR (W.RODZ_DZIAL_ID = 'RK2') OR (W.RODZ_DZIAL_ID = 'RK3') OR (W.RODZ_DZIAL_ID = 'RKA') OR (W.RODZ_DZIAL_ID = 'RKB') OR (W.RODZ_DZIAL_ID = 'INK') OR (W.RODZ_DZIAL_ID = 'NK1') OR (W.RODZ_DZIAL_ID = 'NK2') OR (W.RODZ_DZIAL_ID = 'NK3') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W22') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M37') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M25') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'WT1') OR (W.RODZ_DZIAL_ID = 'WT2') OR (W.RODZ_DZIAL_ID = 'WT3') OR (W.RODZ_DZIAL_ID = 'WT4') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WS1') OR (W.RODZ_DZIAL_ID = 'M26') OR (W.RODZ_DZIAL_ID = 'M27') OR (W.RODZ_DZIAL_ID = 'M28') OR (W.RODZ_DZIAL_ID = 'MB1') OR (W.RODZ_DZIAL_ID = 'UR1') OR (W.RODZ_DZIAL_ID = 'UV1') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'WE5') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3'))
GROUP BY
	U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
UNION ALL
SELECT
	CAST(2 AS INTEGER) AS TYP
	, U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, W.RODZ_DZIAL_ID
	, RD.RODZ_DZIAL_NAZWA
	, CAST(NULL AS DECIMAL(10, 2)) AS WAR_PROCENT
	, COUNT(DISTINCT U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ) AS ILE_UMOW
	, COUNT(*) AS ILE_WARUNKOW
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2015-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_OBOWIAZUJE
	, COUNT(DISTINCT(CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END)) AS ILE_ZAWARTYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_ZAKONCZONYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_E
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'E' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2015-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_I
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'I' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2015-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_K
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'K' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2015-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_K
FROM
	UMOWA U
	INNER JOIN WARUNKI W ON W.UMOWA_ID = U.UMOWA_ID AND W.DYR_ID = U.DYR_ID AND W.UMOWA_ID_SEQ = U.UMOWA_ID_SEQ
	LEFT JOIN RODZAJ_UMOWY RU ON RU.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RU.TYP_UMOWY_ID = U.TYP_UMOWY_ID
	LEFT JOIN RODZAJ_DZIAL RD ON RD.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RD.TYP_UMOWY_ID = U.TYP_UMOWY_ID AND RD.RODZ_DZIAL_ID = W.RODZ_DZIAL_ID
WHERE
	U.DYR_ID = 14
	AND RD.RODZ_DZIAL_ID IS NOT NULL
	AND ((W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WC2') OR (W.RODZ_DZIAL_ID = 'WC1') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE7') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WE*') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'WM*') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'UF1') OR (W.RODZ_DZIAL_ID = 'UF2') OR (W.RODZ_DZIAL_ID = 'UFV') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W32') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'RK1') OR (W.RODZ_DZIAL_ID = 'RK2') OR (W.RODZ_DZIAL_ID = 'RK3') OR (W.RODZ_DZIAL_ID = 'RKA') OR (W.RODZ_DZIAL_ID = 'RKB') OR (W.RODZ_DZIAL_ID = 'INK') OR (W.RODZ_DZIAL_ID = 'NK1') OR (W.RODZ_DZIAL_ID = 'NK2') OR (W.RODZ_DZIAL_ID = 'NK3') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W22') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M37') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M25') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'WT1') OR (W.RODZ_DZIAL_ID = 'WT2') OR (W.RODZ_DZIAL_ID = 'WT3') OR (W.RODZ_DZIAL_ID = 'WT4') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WS1') OR (W.RODZ_DZIAL_ID = 'M26') OR (W.RODZ_DZIAL_ID = 'M27') OR (W.RODZ_DZIAL_ID = 'M28') OR (W.RODZ_DZIAL_ID = 'MB1') OR (W.RODZ_DZIAL_ID = 'UR1') OR (W.RODZ_DZIAL_ID = 'UV1') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'WE5') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3'))
GROUP BY
	U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, W.RODZ_DZIAL_ID
	, RD.RODZ_DZIAL_NAZWA
UNION ALL
SELECT
	CAST(3 AS INTEGER) AS TYP
	, U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, W.RODZ_DZIAL_ID
	, RD.RODZ_DZIAL_NAZWA
	, W.WAR_PROCENT
	, COUNT(DISTINCT U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ) AS ILE_UMOW
	, COUNT(*) AS ILE_WARUNKOW
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2015-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_OBOWIAZUJE
	, COUNT(DISTINCT(CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END)) AS ILE_ZAWARTYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_ZAKONCZONYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_E
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'E' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2015-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_I
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'I' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2015-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_K
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'K' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2015-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2015-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2015-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2015-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2015-01-01' AS DATE) AND CAST('2015-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_K
FROM
	UMOWA U
	INNER JOIN WARUNKI W ON W.UMOWA_ID = U.UMOWA_ID AND W.DYR_ID = U.DYR_ID AND W.UMOWA_ID_SEQ = U.UMOWA_ID_SEQ
	LEFT JOIN RODZAJ_UMOWY RU ON RU.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RU.TYP_UMOWY_ID = U.TYP_UMOWY_ID
	LEFT JOIN RODZAJ_DZIAL RD ON RD.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RD.TYP_UMOWY_ID = U.TYP_UMOWY_ID AND RD.RODZ_DZIAL_ID = W.RODZ_DZIAL_ID
WHERE
	U.DYR_ID = 14
	AND RD.RODZ_DZIAL_ID IS NOT NULL
	AND ((W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WC2') OR (W.RODZ_DZIAL_ID = 'WC1') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE7') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WE*') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'WM*') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'UF1') OR (W.RODZ_DZIAL_ID = 'UF2') OR (W.RODZ_DZIAL_ID = 'UFV') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W32') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'RK1') OR (W.RODZ_DZIAL_ID = 'RK2') OR (W.RODZ_DZIAL_ID = 'RK3') OR (W.RODZ_DZIAL_ID = 'RKA') OR (W.RODZ_DZIAL_ID = 'RKB') OR (W.RODZ_DZIAL_ID = 'INK') OR (W.RODZ_DZIAL_ID = 'NK1') OR (W.RODZ_DZIAL_ID = 'NK2') OR (W.RODZ_DZIAL_ID = 'NK3') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W22') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M37') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M25') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'WT1') OR (W.RODZ_DZIAL_ID = 'WT2') OR (W.RODZ_DZIAL_ID = 'WT3') OR (W.RODZ_DZIAL_ID = 'WT4') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WS1') OR (W.RODZ_DZIAL_ID = 'M26') OR (W.RODZ_DZIAL_ID = 'M27') OR (W.RODZ_DZIAL_ID = 'M28') OR (W.RODZ_DZIAL_ID = 'MB1') OR (W.RODZ_DZIAL_ID = 'UR1') OR (W.RODZ_DZIAL_ID = 'UV1') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'WE5') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3'))
GROUP BY
	U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, W.RODZ_DZIAL_ID
	, RD.RODZ_DZIAL_NAZWA
	, W.WAR_PROCENT
UNION ALL
SELECT
	CAST(4 AS INTEGER) AS TYP
	, U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, CAST(NULL AS CHAR(3)) AS RODZ_DZIAL_ID
	, CAST(NULL AS VARCHAR(60)) AS RODZ_DZIAL_NAZWA
	, CAST(NULL AS DECIMAL(10, 2)) AS WAR_PROCENT
	, COUNT(DISTINCT U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ) AS ILE_UMOW
	, COUNT(*) AS ILE_WARUNKOW
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_OBOWIAZUJE
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_ZAWARTYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_ZAKONCZONYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_E
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'E' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_I
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'I' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_K
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'K' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_K
FROM
	UMOWA U
	INNER JOIN WARUNKI W ON W.UMOWA_ID = U.UMOWA_ID AND W.DYR_ID = U.DYR_ID AND W.UMOWA_ID_SEQ = U.UMOWA_ID_SEQ
	LEFT JOIN RODZAJ_UMOWY RU ON RU.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RU.TYP_UMOWY_ID = U.TYP_UMOWY_ID
	LEFT JOIN RODZAJ_DZIAL RD ON RD.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RD.TYP_UMOWY_ID = U.TYP_UMOWY_ID AND RD.RODZ_DZIAL_ID = W.RODZ_DZIAL_ID
WHERE
	U.DYR_ID = 14
	AND RD.RODZ_DZIAL_ID IS NOT NULL
	AND ((W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WC2') OR (W.RODZ_DZIAL_ID = 'WC1') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE7') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WE*') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'WM*') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'UF1') OR (W.RODZ_DZIAL_ID = 'UF2') OR (W.RODZ_DZIAL_ID = 'UFV') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W32') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'RK1') OR (W.RODZ_DZIAL_ID = 'RK2') OR (W.RODZ_DZIAL_ID = 'RK3') OR (W.RODZ_DZIAL_ID = 'RKA') OR (W.RODZ_DZIAL_ID = 'RKB') OR (W.RODZ_DZIAL_ID = 'INK') OR (W.RODZ_DZIAL_ID = 'NK1') OR (W.RODZ_DZIAL_ID = 'NK2') OR (W.RODZ_DZIAL_ID = 'NK3') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W22') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M37') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M25') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'WT1') OR (W.RODZ_DZIAL_ID = 'WT2') OR (W.RODZ_DZIAL_ID = 'WT3') OR (W.RODZ_DZIAL_ID = 'WT4') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WS1') OR (W.RODZ_DZIAL_ID = 'M26') OR (W.RODZ_DZIAL_ID = 'M27') OR (W.RODZ_DZIAL_ID = 'M28') OR (W.RODZ_DZIAL_ID = 'MB1') OR (W.RODZ_DZIAL_ID = 'UR1') OR (W.RODZ_DZIAL_ID = 'UV1') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'WE5') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3'))
GROUP BY
	U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
UNION ALL
SELECT
	CAST(5 AS INTEGER) AS TYP
	, U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, W.RODZ_DZIAL_ID
	, RD.RODZ_DZIAL_NAZWA
	, CAST(NULL AS DECIMAL(10, 2)) AS WAR_PROCENT
	, COUNT(DISTINCT U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ) AS ILE_UMOW
	, COUNT(*) AS ILE_WARUNKOW
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2014-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_OBOWIAZUJE
	, COUNT(DISTINCT(CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END)) AS ILE_ZAWARTYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_ZAKONCZONYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_E
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'E' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2014-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_I
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'I' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2014-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_K
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'K' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2014-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_K
FROM
	UMOWA U
	INNER JOIN WARUNKI W ON W.UMOWA_ID = U.UMOWA_ID AND W.DYR_ID = U.DYR_ID AND W.UMOWA_ID_SEQ = U.UMOWA_ID_SEQ
	LEFT JOIN RODZAJ_UMOWY RU ON RU.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RU.TYP_UMOWY_ID = U.TYP_UMOWY_ID
	LEFT JOIN RODZAJ_DZIAL RD ON RD.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RD.TYP_UMOWY_ID = U.TYP_UMOWY_ID AND RD.RODZ_DZIAL_ID = W.RODZ_DZIAL_ID
WHERE
	U.DYR_ID = 14
	AND RD.RODZ_DZIAL_ID IS NOT NULL
	AND ((W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WC2') OR (W.RODZ_DZIAL_ID = 'WC1') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE7') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WE*') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'WM*') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'UF1') OR (W.RODZ_DZIAL_ID = 'UF2') OR (W.RODZ_DZIAL_ID = 'UFV') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W32') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'RK1') OR (W.RODZ_DZIAL_ID = 'RK2') OR (W.RODZ_DZIAL_ID = 'RK3') OR (W.RODZ_DZIAL_ID = 'RKA') OR (W.RODZ_DZIAL_ID = 'RKB') OR (W.RODZ_DZIAL_ID = 'INK') OR (W.RODZ_DZIAL_ID = 'NK1') OR (W.RODZ_DZIAL_ID = 'NK2') OR (W.RODZ_DZIAL_ID = 'NK3') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W22') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M37') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M25') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'WT1') OR (W.RODZ_DZIAL_ID = 'WT2') OR (W.RODZ_DZIAL_ID = 'WT3') OR (W.RODZ_DZIAL_ID = 'WT4') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WS1') OR (W.RODZ_DZIAL_ID = 'M26') OR (W.RODZ_DZIAL_ID = 'M27') OR (W.RODZ_DZIAL_ID = 'M28') OR (W.RODZ_DZIAL_ID = 'MB1') OR (W.RODZ_DZIAL_ID = 'UR1') OR (W.RODZ_DZIAL_ID = 'UV1') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'WE5') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3'))
GROUP BY
	U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, W.RODZ_DZIAL_ID
	, RD.RODZ_DZIAL_NAZWA
UNION ALL
SELECT
	CAST(6 AS INTEGER) AS TYP
	, U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, W.RODZ_DZIAL_ID
	, RD.RODZ_DZIAL_NAZWA
	, W.WAR_PROCENT
	, COUNT(DISTINCT U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ) AS ILE_UMOW
	, COUNT(*) AS ILE_WARUNKOW
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2014-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_OBOWIAZUJE
	, COUNT(DISTINCT(CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END)) AS ILE_ZAWARTYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_ZAKONCZONYCH
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_E
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'E' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2014-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'E' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_E
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_I
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'I' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2014-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'I' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_I
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END) AS ILE_UMOW_K
	, SUM(CASE WHEN U.UMOWA_ZRODLO = 'K' THEN 1 ELSE 0 END) AS ILE_WARUNKOW_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_OD <= CAST('2014-12-31' AS DATE) AND (U.UMOWA_DATA_DO IS NULL OR (U.UMOWA_DATA_DO IS NOT NULL AND U.UMOWA_DATA_DO >= CAST('2014-01-01' AS DATE))) AND W.WAR_DATA_OD <= CAST('2014-12-31' AS DATE) AND ((W.WAR_DATA_DO IS NULL) OR (W.WAR_DATA_DO IS NOT NULL AND W.WAR_DATA_DO >= CAST('2014-01-01' AS DATE))) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_OBOWIAZUJE_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_ZAWARCIA BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAWARTYCH_K
	, COUNT(DISTINCT CASE WHEN U.UMOWA_ZRODLO = 'K' THEN CASE WHEN U.UMOWA_DATA_DO BETWEEN CAST('2014-01-01' AS DATE) AND CAST('2014-12-31' AS DATE) THEN U.UMOWA_ID || '_' || U.DYR_ID || '_' || U.UMOWA_ID_SEQ ELSE NULL END ELSE NULL END) AS ILE_ZAKONCZONYCH_K
FROM
	UMOWA U
	INNER JOIN WARUNKI W ON W.UMOWA_ID = U.UMOWA_ID AND W.DYR_ID = U.DYR_ID AND W.UMOWA_ID_SEQ = U.UMOWA_ID_SEQ
	LEFT JOIN RODZAJ_UMOWY RU ON RU.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RU.TYP_UMOWY_ID = U.TYP_UMOWY_ID
	LEFT JOIN RODZAJ_DZIAL RD ON RD.RODZ_UMOWY_ID = U.RODZ_UMOWY_ID AND RD.TYP_UMOWY_ID = U.TYP_UMOWY_ID AND RD.RODZ_DZIAL_ID = W.RODZ_DZIAL_ID
WHERE
	U.DYR_ID = 14
	AND RD.RODZ_DZIAL_ID IS NOT NULL
	AND ((W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WC2') OR (W.RODZ_DZIAL_ID = 'WC1') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE7') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WE*') OR (W.RODZ_DZIAL_ID = 'WE1') OR (W.RODZ_DZIAL_ID = 'WE2') OR (W.RODZ_DZIAL_ID = 'WE3') OR (W.RODZ_DZIAL_ID = 'WE4') OR (W.RODZ_DZIAL_ID = 'WE6') OR (W.RODZ_DZIAL_ID = 'WE9') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'WM*') OR (W.RODZ_DZIAL_ID = 'WM2') OR (W.RODZ_DZIAL_ID = 'WM3') OR (W.RODZ_DZIAL_ID = 'WM4') OR (W.RODZ_DZIAL_ID = 'UF1') OR (W.RODZ_DZIAL_ID = 'UF2') OR (W.RODZ_DZIAL_ID = 'UFV') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'M38') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W32') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'RK1') OR (W.RODZ_DZIAL_ID = 'RK2') OR (W.RODZ_DZIAL_ID = 'RK3') OR (W.RODZ_DZIAL_ID = 'RKA') OR (W.RODZ_DZIAL_ID = 'RKB') OR (W.RODZ_DZIAL_ID = 'INK') OR (W.RODZ_DZIAL_ID = 'NK1') OR (W.RODZ_DZIAL_ID = 'NK2') OR (W.RODZ_DZIAL_ID = 'NK3') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'W22') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M35') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M37') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'MV1') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP1') OR (W.RODZ_DZIAL_ID = 'PV1') OR (W.RODZ_DZIAL_ID = 'PV2') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'PZ1') OR (W.RODZ_DZIAL_ID = 'PZ2') OR (W.RODZ_DZIAL_ID = 'PZ3') OR (W.RODZ_DZIAL_ID = 'M23') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M30') OR (W.RODZ_DZIAL_ID = 'M31') OR (W.RODZ_DZIAL_ID = 'M32') OR (W.RODZ_DZIAL_ID = 'M33') OR (W.RODZ_DZIAL_ID = 'M34') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'MZ3') OR (W.RODZ_DZIAL_ID = 'MZ4') OR (W.RODZ_DZIAL_ID = 'MZ5') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M11') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M17') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M21') OR (W.RODZ_DZIAL_ID = 'M25') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M24') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M14') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M18') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'M12') OR (W.RODZ_DZIAL_ID = 'M13') OR (W.RODZ_DZIAL_ID = 'M15') OR (W.RODZ_DZIAL_ID = 'M16') OR (W.RODZ_DZIAL_ID = 'M20') OR (W.RODZ_DZIAL_ID = 'WT1') OR (W.RODZ_DZIAL_ID = 'WT2') OR (W.RODZ_DZIAL_ID = 'WT3') OR (W.RODZ_DZIAL_ID = 'WT4') OR (W.RODZ_DZIAL_ID = 'MZ2') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WS1') OR (W.RODZ_DZIAL_ID = 'M26') OR (W.RODZ_DZIAL_ID = 'M27') OR (W.RODZ_DZIAL_ID = 'M28') OR (W.RODZ_DZIAL_ID = 'MB1') OR (W.RODZ_DZIAL_ID = 'UR1') OR (W.RODZ_DZIAL_ID = 'UV1') OR (W.RODZ_DZIAL_ID = 'W21') OR (W.RODZ_DZIAL_ID = 'W30') OR (W.RODZ_DZIAL_ID = 'W31') OR (W.RODZ_DZIAL_ID = 'WA1') OR (W.RODZ_DZIAL_ID = 'WZ1') OR (W.RODZ_DZIAL_ID = 'WZ2') OR (W.RODZ_DZIAL_ID = 'WZ3') OR (W.RODZ_DZIAL_ID = 'WZ4') OR (W.RODZ_DZIAL_ID = 'WE5') OR (W.RODZ_DZIAL_ID = 'PP2') OR (W.RODZ_DZIAL_ID = 'PP3'))
GROUP BY
	U.TYP_UMOWY_ID
	, U.RODZ_UMOWY_ID
	, RU.RODZ_UMOWY_NAZWA
	, W.RODZ_DZIAL_ID
	, RD.RODZ_DZIAL_NAZWA
	, W.WAR_PROCENT
ORDER BY
	1
	, 3
	, 6
	, 7